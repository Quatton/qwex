{"components":{"schemas":{"AuthorizeBody":{"additionalProperties":false,"properties":{"$schema":{"description":"A URL to the JSON Schema for this object.","example":"https://example.com/schemas/AuthorizeBody.json","format":"uri","readOnly":true,"type":"string"},"authorize_url":{"description":"URL to redirect user to for OAuth authorization","type":"string"},"state":{"description":"State parameter for CSRF protection","type":"string"}},"required":["authorize_url","state"],"type":"object"},"ErrorDetail":{"additionalProperties":false,"properties":{"location":{"description":"Where the error occurred, e.g. 'body.items[3].tags' or 'path.thing-id'","type":"string"},"message":{"description":"Error message text","type":"string"},"value":{"description":"The value at the given location"}},"type":"object"},"ErrorModel":{"additionalProperties":false,"properties":{"$schema":{"description":"A URL to the JSON Schema for this object.","example":"https://example.com/schemas/ErrorModel.json","format":"uri","readOnly":true,"type":"string"},"detail":{"description":"A human-readable explanation specific to this occurrence of the problem.","example":"Property foo is required but is missing.","type":"string"},"errors":{"description":"Optional list of individual error details","items":{"$ref":"#/components/schemas/ErrorDetail"},"nullable":true,"type":"array"},"instance":{"description":"A URI reference that identifies the specific occurrence of the problem.","example":"https://example.com/error-log/abc123","format":"uri","type":"string"},"status":{"description":"HTTP status code","example":400,"format":"int64","type":"integer"},"title":{"description":"A short, human-readable summary of the problem type. This value should not change between occurrences of the error.","example":"Bad Request","type":"string"},"type":{"default":"about:blank","description":"A URI reference to human-readable documentation for the error.","example":"https://example.com/errors/example","format":"uri","type":"string"}},"type":"object"},"HealthOutputBody":{"additionalProperties":false,"properties":{"$schema":{"description":"A URL to the JSON Schema for this object.","example":"https://example.com/schemas/HealthOutputBody.json","format":"uri","readOnly":true,"type":"string"},"status":{"description":"Health status","example":"ok","type":"string"}},"required":["status"],"type":"object"},"Item":{"additionalProperties":false,"properties":{"machine_id":{"type":"string"},"status":{"type":"string"}},"required":["machine_id","status"],"type":"object"},"ListMachinesResponseBody":{"additionalProperties":false,"properties":{"$schema":{"description":"A URL to the JSON Schema for this object.","example":"https://example.com/schemas/ListMachinesResponseBody.json","format":"uri","readOnly":true,"type":"string"},"machines":{"items":{"$ref":"#/components/schemas/Item"},"nullable":true,"type":"array"}},"required":["machines"],"type":"object"},"MachineResponseBody":{"additionalProperties":false,"properties":{"$schema":{"description":"A URL to the JSON Schema for this object.","example":"https://example.com/schemas/MachineResponseBody.json","format":"uri","readOnly":true,"type":"string"},"machine_id":{"description":"Unique identifier for the machine","type":"string"},"status":{"description":"Current status of the machine","enum":["creating","starting","running","stopping","stopped"],"type":"string"},"user_id":{"description":"ID of the user who owns the machine","type":"string"}},"required":["machine_id","status"],"type":"object"},"MeResponseBody":{"additionalProperties":false,"properties":{"$schema":{"description":"A URL to the JSON Schema for this object.","example":"https://example.com/schemas/MeResponseBody.json","format":"uri","readOnly":true,"type":"string"},"user":{"$ref":"#/components/schemas/User"}},"required":["user"],"type":"object"},"RefreshTokenRequestBody":{"additionalProperties":false,"properties":{"$schema":{"description":"A URL to the JSON Schema for this object.","example":"https://example.com/schemas/RefreshTokenRequestBody.json","format":"uri","readOnly":true,"type":"string"},"refresh_token":{"description":"Refresh token issued from login or previous refresh","type":"string"}},"required":["refresh_token"],"type":"object"},"RefreshTokenResponseBody":{"additionalProperties":false,"properties":{"$schema":{"description":"A URL to the JSON Schema for this object.","example":"https://example.com/schemas/RefreshTokenResponseBody.json","format":"uri","readOnly":true,"type":"string"},"access_token":{"description":"New short-lived access token","type":"string"},"expires_in":{"description":"Access token lifetime in seconds","format":"int64","type":"integer"},"refresh_token":{"description":"Rotated refresh token","type":"string"},"token_type":{"description":"Token type descriptor","example":"bearer","type":"string"}},"required":["access_token","refresh_token","token_type","expires_in"],"type":"object"},"RootOutputBody":{"additionalProperties":false,"properties":{"$schema":{"description":"A URL to the JSON Schema for this object.","example":"https://example.com/schemas/RootOutputBody.json","format":"uri","readOnly":true,"type":"string"},"message":{"description":"Welcome message","example":"hello world from qwex controller","type":"string"}},"required":["message"],"type":"object"},"User":{"additionalProperties":false,"properties":{"email":{"description":"Email address of the principal","type":"string"},"id":{"description":"Unique identifier for the principal","type":"string"},"login":{"description":"Login name of the principal","type":"string"},"name":{"description":"Full name of the principal","type":"string"}},"required":["id","login","name","email"],"type":"object"}},"securitySchemes":{"bearer":{"bearerFormat":"JWT","description":"JWT token from /api/auth/callback","scheme":"bearer","type":"http"}}},"info":{"title":"qwex Controller","version":"1.0.0"},"openapi":"3.0.3","paths":{"/":{"get":{"description":"Returns a welcome message","operationId":"get-root","responses":{"200":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RootOutputBody"}}},"description":"OK"},"default":{"content":{"application/problem+json":{"schema":{"$ref":"#/components/schemas/ErrorModel"}}},"description":"Error"}},"summary":"Root endpoint","tags":["General"]}},"/api/auth/callback":{"get":{"description":"Handles the OAuth callback, exchanges code for token, and returns JWT","operationId":"auth-callback","parameters":[{"description":"Authorization code from OAuth provider","explode":false,"in":"query","name":"code","required":true,"schema":{"description":"Authorization code from OAuth provider","type":"string"}},{"description":"State parameter for CSRF validation","explode":false,"in":"query","name":"state","required":true,"schema":{"description":"State parameter for CSRF validation","type":"string"}}],"responses":{"204":{"description":"No Content","headers":{"Location":{"schema":{"description":"Redirect location when response_mode=redirect","type":"string"}}}},"default":{"content":{"application/problem+json":{"schema":{"$ref":"#/components/schemas/ErrorModel"}}},"description":"Error"}},"summary":"OAuth callback handler","tags":["iam"]}},"/api/auth/login":{"get":{"description":"Starts the OAuth authentication process by redirecting to the provider","operationId":"auth-login","parameters":[{"description":"URI to redirect after authentication","example":"http://localhost:8080/callback","explode":false,"in":"query","name":"redirect_uri","schema":{"description":"URI to redirect after authentication","example":"http://localhost:8080/callback","type":"string"}},{"description":"Upstream OAuth provider","example":"github","explode":false,"in":"query","name":"provider","schema":{"default":"github","description":"Upstream OAuth provider","enum":["github"],"example":"github","type":"string"}},{"description":"Whether to include the minted token in the callback redirect","explode":false,"in":"query","name":"include_token","schema":{"default":true,"description":"Whether to include the minted token in the callback redirect","type":"boolean"}}],"responses":{"200":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/AuthorizeBody"}}},"description":"OK","headers":{"Location":{"schema":{"description":"Redirect location when response_mode=redirect","type":"string"}}}},"default":{"content":{"application/problem+json":{"schema":{"$ref":"#/components/schemas/ErrorModel"}}},"description":"Error"}},"summary":"Initiate authentication","tags":["iam"]}},"/api/auth/refresh":{"post":{"description":"Exchanges a valid refresh token for a new access token and rotated refresh token","operationId":"auth-refresh","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RefreshTokenRequestBody"}}},"required":true},"responses":{"200":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RefreshTokenResponseBody"}}},"description":"OK"},"default":{"content":{"application/problem+json":{"schema":{"$ref":"#/components/schemas/ErrorModel"}}},"description":"Error"}},"summary":"Refresh access token","tags":["iam"]}},"/api/machines":{"get":{"description":"List all machines owned by the authenticated user","operationId":"list-machines","responses":{"200":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ListMachinesResponseBody"}}},"description":"OK"},"default":{"content":{"application/problem+json":{"schema":{"$ref":"#/components/schemas/ErrorModel"}}},"description":"Error"}},"security":[{"bearer":[]}],"summary":"List user's machines","tags":["Machines"]},"post":{"description":"Creates and starts a new machine (pod) with the uv image","operationId":"create-machine","responses":{"200":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/MachineResponseBody"}}},"description":"OK"},"default":{"content":{"application/problem+json":{"schema":{"$ref":"#/components/schemas/ErrorModel"}}},"description":"Error"}},"security":[{"bearer":[]}],"summary":"Create a new machine","tags":["Machines"]}},"/api/machines/{machine_id}":{"delete":{"description":"Stops and deletes a machine (pod) and all associated resources","operationId":"delete-machine","parameters":[{"description":"The machine ID to delete","in":"path","name":"machine_id","required":true,"schema":{"description":"The machine ID to delete","format":"uuid","type":"string"}}],"responses":{"200":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/MachineResponseBody"}}},"description":"OK"},"default":{"content":{"application/problem+json":{"schema":{"$ref":"#/components/schemas/ErrorModel"}}},"description":"Error"}},"security":[{"bearer":[]}],"summary":"Delete a machine","tags":["Machines"]}},"/api/me":{"get":{"description":"Retrieves information about the currently authenticated user","operationId":"get-me","responses":{"200":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/MeResponseBody"}}},"description":"OK"},"default":{"content":{"application/problem+json":{"schema":{"$ref":"#/components/schemas/ErrorModel"}}},"description":"Error"}},"security":[{"bearer":[]}],"summary":"Get current user","tags":["iam"]}},"/health":{"get":{"description":"Returns the health status of the controller","operationId":"health-check","responses":{"200":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/HealthOutputBody"}}},"description":"OK"},"default":{"content":{"application/problem+json":{"schema":{"$ref":"#/components/schemas/ErrorModel"}}},"description":"Error"}},"summary":"Health check","tags":["General"]}}}}
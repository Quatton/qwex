{# ssh.sh.j2 - SSH access layer #}
{# Props: host, user (optional), port (optional), key_file (optional), config (optional) #}

# L1: SSH to {{ user ~ "@" if user else "" }}{{ host }}
{% set ssh_args = [] %}
{% if config %}
{% set _ = ssh_args.append("-F " ~ config) %}
{% endif %}
{% if key_file %}
{% set _ = ssh_args.append("-i " ~ key_file) %}
{% endif %}
{% if port and port != 22 %}
{% set _ = ssh_args.append("-p " ~ port) %}
{% endif %}
{% set target = (user ~ "@" if user else "") ~ host %}

ssh {{ ssh_args | join(" ") }} {{ target }} "$@"
